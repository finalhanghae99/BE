# :tent: 캠핑집 프로젝트(CampingZip)

### 프로젝트 기간
2022.12.30 ~ 2023.02.10
 <br />
 
### 멤버 정보
|Name|Role|Github|
|------|---|---|
|이원문|FE|https://github.com/dnjsans|
|김정훈|FE|https://github.com/44Chick|
|김성현|BE|https://github.com/seonghyun-1|
|박종범|BE|https://github.com/JongBeomPark78|
|진효제|BE|https://github.com/jinhyoje|
|오은지|Design||

 <br />
 
## :cherries: 서비스 소개
 행복한 캠핑을 위해 캠핑장의 정보를 제공하는 저희 서비스의 이름은 캠핑집(CAMPINGZIP)입니다. 
 <br />
 텐트를 열고 캠핑의 세상을 열어보자는 의미로 캠핑집(CAMPINGZIP)으로 서비스의 이름을 정했습니다.
 
 <a href="https://www.campingzip.site/">
 CampingZip 바로가기
 </a>

### 캠핑집 웹 어플리케이션은 다음과 같은 기능을 제공합니다.
1. 전국 3천여개 캠핑장의 각 지역별 정보검색기능(OPEN API 활용)
2. 캠핑장에 대한 리뷰생성 및 즐겨찾기 기능
3. 캠핑장 양도글 게시기능 및 채팅기능 제공
 <br />
 <div>
 <img width="200px" src="https://user-images.githubusercontent.com/49892292/217457917-cd22725a-f193-46b7-b18b-e4772a1fa724.gif"/>
 <img width="200px" src="https://user-images.githubusercontent.com/49892292/217453401-77d12b0b-b8bd-40e7-ba94-d666c0d8a7bc.gif" />
<img width="200px" src="https://user-images.githubusercontent.com/49892292/217457688-96a7ea6a-be27-468e-bc8b-283fe3a383d1.gif" />
<img width="200px" src="https://user-images.githubusercontent.com/49892292/217457704-f9b07355-aa47-4cc3-8edf-d699bf696e7e.gif" />
 </div>

<br />

##  :grapes:  기술스택

### 프론트 기술스택
<!-- <img src="https://img.shields.io/badge/표시할이름-색상?style=for-the-badge&logo=기술스택아이콘&logoColor=white"> -->
<div>
<img src="https://img.shields.io/badge/javascript-F7DF1E?style=for-the-badge&logo=javascript&logoColor=black">
<img src="https://img.shields.io/badge/react-61DAFB?style=for-the-badge&logo=react&logoColor=black">
<img src="https://img.shields.io/badge/redux-764ABC?style=for-the-badge&logo=redux&logoColor=white">
<img src="https://img.shields.io/badge/react router-CA4245?style=for-the-badge&logo=React Router&logoColor=white">
<img src="https://img.shields.io/badge/styled components-DB7093?style=for-the-badge&logo=styled-components&logoColor=white">
<img src="https://img.shields.io/badge/Axios-5A29E4?style=for-the-badge&logo=Axios&logoColor=white">
<img src="https://img.shields.io/badge/SockJS-69c832?style=for-the-badge&logo=&logoColor=white">
<img src="https://img.shields.io/badge/STOMP-372805?style=for-the-badge&logo=&logoColor=white">
<img src="https://img.shields.io/badge/kakao maps-FFCD00?style=for-the-badge&logo=Kakao&logoColor=black">
<img src="https://img.shields.io/badge/AWS Amplify-FF9900?style=for-the-badge&logo=AWS Amplify&logoColor=white">
<img src="https://img.shields.io/badge/git-F05032?style=for-the-badge&logo=git&logoColor=white">
<img src="https://img.shields.io/badge/github-181717?style=for-the-badge&logo=github&logoColor=white">
<img src="https://img.shields.io/badge/yarn-2C8EBB?style=for-the-badge&logo=yarn&logoColor=white">
<img src="https://img.shields.io/badge/Visual Studio Code-007ACC?style=for-the-badge&logo=Visual Studio Code&logoColor=white">
</div>


### 벡엔드 기술스택
<div>
<img src="https://img.shields.io/badge/Java-cd0000?style=for-the-badge&logo=&logoColor=white">
<img src="https://img.shields.io/badge/spring-6DB33F?style=for-the-badge&logo=spring&logoColor=white">
<img src="https://img.shields.io/badge/spring boot-6DB33F?style=for-the-badge&logo=spring boot&logoColor=white">
<img src="https://img.shields.io/badge/MySQL-4479A1?style=for-the-badge&logo=MySQL&logoColor=white">
<img src="https://img.shields.io/badge/Amazon EC2-FF9900?style=for-the-badge&logo=Amazon EC2&logoColor=white">
<img src="https://img.shields.io/badge/Amazon S3-569A31?style=for-the-badge&logo=Amazon S3&logoColor=white">
<img src="https://img.shields.io/badge/Amazon RDS-527FFF?style=for-the-badge&logo=Amazon RDS&logoColor=white">
<img src="https://img.shields.io/badge/STOMP-372805?style=for-the-badge&logo=&logoColor=white">
<img src="https://img.shields.io/badge/IntelliJ IDEA-000000?style=for-the-badge&logo=IntelliJ IDEA&logoColor=white">
<img src="https://img.shields.io/badge/git-F05032?style=for-the-badge&logo=git&logoColor=white">
<img src="https://img.shields.io/badge/github-181717?style=for-the-badge&logo=github&logoColor=white">
</div>
 <br /> <br />
 
## :strawberry: 전체 아키텍처

 <div markdown="1">
  <img src="https://user-images.githubusercontent.com/49892292/217412803-f73c1678-5f28-43ae-80bb-9bee084b227f.png">
 </div>

## :peach: 주요 기능

✅ 지도 (kakao Map)

- 검색한 캠핑장의 위치정보 제공
- 지도 마커 기능을 사용해서 지도에서 정확한 위치 제공

![지도](https://user-images.githubusercontent.com/49892292/217447121-c2b3435c-e55b-48fa-8b31-97aa820eb9d5.png)


✅ 채팅 (WebSocket)

- 채팅방 양도글에 대한 채팅방 생성
- 실시간 채팅을 통해 판매자와 구매자간의 실시간 소통 가능

![채팅](https://user-images.githubusercontent.com/49892292/217447128-801728a8-4eb4-4e09-b584-f5ea22c28e2a.png)


✅ 캠핑장 검색 기능

- Open API를 사용한 3000개가 넘는 캠핑장 정보를 확인 가능
- 띄어쓰기 없이 검색을 해도 검색 가능
- 최근 검색 데이터 확인 가능

![검색](https://user-images.githubusercontent.com/49892292/217447135-d92b340e-46ef-4e56-8d46-9f1e72d400d8.png)


## :watermelon: 트러블 슈팅
<details>
<summary>✔️ 채팅 실시간 렌더링(FE)</summary>
<div markdown="1">
 
**`문제사항`**

실시간으로 받아오는 정보를 즉각적으로 렌더링 해야 함.
컴포넌트 안에서 해당 메시지들을 state로 관리하여, 그것을 변경 함으로써 레더링이 이루어지게 함.
함수 내에서 setState를 하지만, 그 값이 적용이 안되며, 메시지를 받을때마다 덮어쓰여짐.

**`해결방법`**

현재 사용하고있는 redux에 주목.
전역으로 state를 관리하고 있는 redux 를 사용하면 어떨까 라는 궁굼점이 생김.
표시하는 메시지들을 redux의 store로 꺼낸후 다시 실행 하며 해결이 됨.
</div>
</details>

<details>
<summary>✔️ 다중 이미지 업로드(FE)</summary>
<div markdown="1">
 
**`문제사항`**

이미지 업로드 시 백 서버로 전송하는 과정에서 이미지와 또 다른 객체를 함께 보내야하는 상황, 이미지, 객체를 따로 처리하여 전송할 것인지, 함께 보낼 것인지
이미지와 객체를 각각 처리 할 경우 데이터 요청을 2번해야하는 문제가 발생함.

**`해결방법`**

백 서버에 이미지를 그냥 보낼 경우 백 서버에서 받아들이기 어려웠고, multifile이라는 타입을 확인하여 FormData()라는 메소드를 사용해 새로운 객체로 만들어 백 서버로 보내도록 했음. 
FormData() 객체 안에 나머지 필요 데이터도 함께 넣어 보내기로 백 서버와 협의 하였고, 
이미지 파일과 다른 객체를 함께 백 서버로 전송하기 위해 필요한 데이터를 JSON.stringify를 사용하여 변경한 JSON 문자열을 new Blob() 메소드를 사용하여 새로운 Blob 객체를 만들어 FormData 안에 함께 넣어 백 서버로 보내 처리함.
 
</div>
</details>

<details>
<summary>✔️ Web Socket 유저 정보(BE)</summary>
<div markdown="1">
 
**`문제사항`**
 
채팅을 하게 될 경우 채팅을 하는 사람과 받는 사람을 구별하여 정보를 받아와야 했다. 
처음엔 로그인 한 유저의 정보를 받아오는 @AuthenticationPrincipal를 사용하여 받아오려고 했으나 소켓 통신은 http와 다르게 header가 존재하지 않아 토근을 받아올 수 없다는 사실을 발견했다. 

**`해결방법`**

차선책으로 1대1 채팅이고 처음 채팅 할 때 받는 사람은 양도글을 작성한 사람으로 고정되어 있기 때문에 sender와 receiver로 나누어서 정보를 저장하기로 했다.
sender는 양도 받길 원하는 사람 receiver는 양도글을 작성한 사람으로 고정시켜서 채팅방에 유저 정보를 보내줬다.
 
</div>
</details>

<details>
<summary>✔️ 실시간 통신 중 시간 표시(BE)</summary>
<div markdown="1">
 
**`문제사항`**

채팅을 할 때 메시지를 보낸 시간이 UTC 시간으로 표시가 되는 문제가 있었다.

**`해결방법`**

처음에는 서버쪽 문제로 인식을 해서 EC2 서버의 시간과 RDS 서버의 시간을 KST로 변경하고 Spring 코드 자체에서 TimeZone을 Asia/Seoul 로 변경했다.  
하지만 문제가 이걸로 해결이 안되서 더 조사한 결과 JS에서 사용하는 JSON.stringify가 시간 타입의 정보를 문자열로 변경할 때 정보를 UTC 기준으로 강제 변경한다는 사실을 알 수 있었다.
이 문제를 해결하기 위해서 JSON.stringify가 시간 타입의 정보를 문자열로 변환하기 전에 문자열로 변환해서 서버로 보내고 서버에서 다시 시간 타입으로 변환하는 과정을 통해 문제를 해결했다.
 
</div>
</details>

<br />
<br />

## :beer: 레퍼런스
<a href="https://www.figma.com/file/g0FYpNqsg3aAhMPu1O1dCD/CampingZip?node-id=0%3A1&t=LhlHY8QwlaFuHsd3-0">
<img src="https://img.shields.io/badge/figma-F24E1E?style=for-the-badge&logo=figma&logoColor=white">

</a>

<a href="https://www.youtube.com/watch?v=mGCpUO4QnSo">
 <img src="https://img.shields.io/badge/youtube-cd0000?style=for-the-badge&logo=youtube&logoColor=white">
 </a>
